(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{486:function(s,a,e){"use strict";e.r(a);var t=e(8),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[s._v("仕事でプッシュ通知について調査する機会があったのでメモ。")]),s._v(" "),e("h2",{attrs:{id:"firebase-導入"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#firebase-導入"}},[s._v("#")]),s._v(" Firebase 導入")]),s._v(" "),e("p",[s._v("参考:"),e("br"),s._v(" "),e("a",{attrs:{href:"https://firebase.google.com/docs/cli?hl=ja",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://firebase.google.com/docs/cli?hl=ja"),e("OutboundLink")],1)]),s._v(" "),e("h3",{attrs:{id:"google-アカウントを用意"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#google-アカウントを用意"}},[s._v("#")]),s._v(" Google アカウントを用意")]),s._v(" "),e("p",[s._v("Firebase を利用するために Google アカウントが必要。")]),s._v(" "),e("h3",{attrs:{id:"nodejs-をインストール"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nodejs-をインストール"}},[s._v("#")]),s._v(" nodejs をインストール")]),s._v(" "),e("p",[s._v("npm を使うため。")]),s._v(" "),e("h3",{attrs:{id:"firebase-tools-導入"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#firebase-tools-導入"}},[s._v("#")]),s._v(" firebase-tools 導入")]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -g firebase-tools\n")])])]),e("h3",{attrs:{id:"firebase-cli-認証設定"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#firebase-cli-認証設定"}},[s._v("#")]),s._v(" firebase-cli 認証設定")]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -g firebase-tools\nfirebase login // ログイン\n")])])]),e("h3",{attrs:{id:"プロジェクトに-firebase-を導入する"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#プロジェクトに-firebase-を導入する"}},[s._v("#")]),s._v(" プロジェクトに Firebase を導入する")]),s._v(" "),e("p",[s._v("プロジェクトディレクトリで以下のコマンドを実行。")]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("firebase init //プロジェクトディレクトリにfirebaseを設定\n")])])]),e("h2",{attrs:{id:"手動で通知を飛ばしてみる"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#手動で通知を飛ばしてみる"}},[s._v("#")]),s._v(" 手動で通知を飛ばしてみる")]),s._v(" "),e("h3",{attrs:{id:"通知の許可を求める＆デバイストークンを取得する。"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#通知の許可を求める＆デバイストークンを取得する。"}},[s._v("#")]),s._v(" 通知の許可を求める＆デバイストークンを取得する。")]),s._v(" "),e("p",[s._v("public ディレクトリに"),e("code",[s._v("index.html")]),s._v(" を作成。")]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[s._v('<script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-app.js"><\/script>\n<script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-messaging.js"><\/script>\n<script>\n  // Your web app\'s Firebase configuration\n  var firebaseConfig = {\n    apiKey: "***",\n    authDomain: "***",\n    databaseURL: "***",\n    projectId: "***",\n    storageBucket: "***",\n    messagingSenderId: "***",\n    appId: "***",\n    measurementId: "***"\n  };\n  const VAPID =\n    "公開鍵";\n\n  // firebaseの初期化\n  firebase.initializeApp(firebaseConfig);\n  // 通知を許可をユーザに求める\n  Notification.requestPermission(function(result) {\n    console.log("User choice", result);\n    if (result !== "granted") {\n      console.log("No notification permission granted!");\n    } else {\n      console.log("ok!");\n      const messaging = firebase.messaging();\n      // 公開鍵を設定\n      messaging.usePublicVapidKey(VAPID);\n\n    // トークン取得\n      messaging.getToken().then(currentToken => {\n          // デバイストークンがコンソールに出力される。\n        console.log(currentToken);\n      });\n    }\n  });\n')])])]),e("p",[s._v("public ディレクトリに以下の "),e("code",[s._v("firebase-messaging-sw.js")]),s._v(" を作成")]),s._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("importScripts")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://www.gstatic.com/firebasejs/6.2.4/firebase-app.js"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("importScripts")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://www.gstatic.com/firebasejs/6.2.4/firebase-messaging.js"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nfirebase"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("initializeApp")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  messagingSenderId"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"***"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" messaging "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" firebase"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("messaging")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),e("h3",{attrs:{id:"デプロイする"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#デプロイする"}},[s._v("#")]),s._v(" デプロイする")]),s._v(" "),e("p",[s._v("firebase hosting にデプロイする。")]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("firebase deploy\n")])])]),e("h3",{attrs:{id:"手動でデバイスに通知を送る"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#手動でデバイスに通知を送る"}},[s._v("#")]),s._v(" 手動でデバイスに通知を送る")]),s._v(" "),e("p",[s._v('"Send your first message"をクリック\n'),e("img",{attrs:{src:"/assets/img/web-push-hands-on-1.png",alt:""}})]),s._v(" "),e("p",[s._v('タイトルとテキストを入力して"テストメッセージを送信"をクリック。\n'),e("img",{attrs:{src:"/assets/img/web-push-hands-on-2.png",alt:""}})]),s._v(" "),e("p",[s._v("先ほどコンソールに出ていたトークンをコピペする。\n"),e("img",{attrs:{src:"/assets/img/web-push-hands-on-3.png",alt:""}})]),s._v(" "),e("p",[s._v("通知が表示される。\n"),e("img",{attrs:{src:"/assets/img/web-push-hands-on-4.png",alt:""}})]),s._v(" "),e("h2",{attrs:{id:"firebase-messaging-sw-js-について"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#firebase-messaging-sw-js-について"}},[s._v("#")]),s._v(" firebase-messaging-sw.js について")]),s._v(" "),e("p",[e("code",[s._v("firebase-messaging-sw.js")]),s._v("(ServiceWorker)では、メッセージ受信時の処理を書くことができる。\nWeb アプリがフォアグラウンド時、バックグラウンド時、閉じられている時で処理を分けて書く。")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://firebase.google.com/docs/cloud-messaging/js/receive?hl=ja#handle_messages_when_your_web_app_is_in_the_foreground",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://firebase.google.com/docs/cloud-messaging/js/receive?hl=ja#handle_messages_when_your_web_app_is_in_the_foreground"),e("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=n.exports}}]);