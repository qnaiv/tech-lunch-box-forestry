(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{484:function(t,a,_){"use strict";_.r(a);var v=_(8),r=Object(v.a)({},(function(){var t=this,a=t.$createElement,_=t._self._c||a;return _("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[_("p",[t._v("仕事で初めて JWT に触れる機会があったので、まとめる。")]),t._v(" "),_("h2",{attrs:{id:"jwt-json-web-token-とは"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#jwt-json-web-token-とは"}},[t._v("#")]),t._v(" JWT(Json Web Token)とは")]),t._v(" "),_("p",[t._v("主に"),_("strong",[t._v("認証が必要な REST API")]),t._v("や、"),_("strong",[t._v("シングルサインオン")]),t._v("を実装する際にアクセストークンとして利用される。")]),t._v(" "),_("p",[t._v("トークンの中に任意の情報（Claim）を格納できる。（認証したユーザの ID やトークンの有効期限など）")]),t._v(" "),_("p",[t._v("トークン生成時に"),_("strong",[t._v("署名")]),t._v("を付けることができ、それにより正規に生成されたトークンかどうかを検証することが可能。⇒"),_("strong",[t._v("改ざん検知")]),t._v("できる。")]),t._v(" "),_("h3",{attrs:{id:"利用例"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#利用例"}},[t._v("#")]),t._v(" 利用例")]),t._v(" "),_("p",[t._v("ログインしてからプライベート API を実行するシンプルなケース。")]),t._v(" "),_("p",[_("img",{attrs:{src:"/assets/img/jwt-introduction-1-97138c8a-beae-4774-ac49-d038425739e5.png",alt:""}})]),t._v(" "),_("h2",{attrs:{id:"jwt-を触ってみる"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#jwt-を触ってみる"}},[t._v("#")]),t._v(" JWT を触ってみる")]),t._v(" "),_("p",[t._v("以下のサイトの「Debugger」で、JWT の生成/検証を試せる。")]),t._v(" "),_("p",[_("a",{attrs:{href:"https://jwt.io",target:"_blank",rel:"noopener noreferrer"}},[t._v("JWT.IO"),_("OutboundLink")],1)]),t._v(" "),_("h3",{attrs:{id:"①jwt-を生成してみる"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#①jwt-を生成してみる"}},[t._v("#")]),t._v(" ①JWT を生成してみる")]),t._v(" "),_("p",[t._v("以下の手順で JWT を生成することができる。")]),t._v(" "),_("p",[_("img",{attrs:{src:"/assets/img/jwt-introduction-2-585aa0e0-8479-4f5e-8724-27756f782341.png",alt:""}})]),t._v(" "),_("h3",{attrs:{id:"②jwt-を検証してみる"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#②jwt-を検証してみる"}},[t._v("#")]),t._v(" ②JWT を検証してみる")]),t._v(" "),_("p",[t._v("不正な JWT を生成し、検証する。")]),t._v(" "),_("p",[_("img",{attrs:{src:"/assets/img/jwt-introduction-3-91af68e8-f0fd-414f-81c8-94bf85d1525c.png",alt:""}})]),t._v(" "),_("h2",{attrs:{id:"構造"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#構造"}},[t._v("#")]),t._v(" 構造")]),t._v(" "),_("p",[t._v("JWT は HEADER, PAYLOAD, SIGNATURE の 3 つの要素で構成され、「.(ピリオド)」で区切られている。")]),t._v(" "),_("p",[_("img",{attrs:{src:"/assets/img/jwt-introduction-4-6d8dce6d-e682-414b-9330-d5d074cd301e.png",alt:""}})]),t._v(" "),_("ol",[_("li",[t._v("HEADER\n"),_("ul",[_("li",[_("p",[t._v("署名生成のアルゴリズムを格納する。")]),t._v(" "),_("p",[t._v('{\n"alg" : "HS256",\n"typ" : "JWT"\n}')])])])]),t._v(" "),_("li",[t._v("PAYLOAD\n"),_("ul",[_("li",[_("p",[t._v("ログインしているユーザの ID や権限など、サーバサイドに受け渡したい情報を格納する。")])]),t._v(" "),_("li",[_("p",[t._v("PAYLOAD には好きな情報を入れられるが、RFC 標準で定義されている項目もある。")]),t._v(" "),_("p",[t._v("標準で定義されている PAYLOAD 項目(一部)")]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("項目名")]),t._v(" "),_("th",[t._v("用途")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("iss")]),t._v(" "),_("td",[t._v("発行者の識別子")])]),t._v(" "),_("tr",[_("td",[t._v("sub")]),t._v(" "),_("td",[t._v("ユーザ識別子。ログインしたユーザの ID などを入れる。")])]),t._v(" "),_("tr",[_("td",[t._v("exp")]),t._v(" "),_("td",[t._v("トークンの有効期限")])]),t._v(" "),_("tr",[_("td",[t._v("iat")]),t._v(" "),_("td",[t._v("トークン発行日時")])])])])]),t._v(" "),_("li",[_("p",[_("strong",[t._v("※PAYLOAD は暗号化されておらず、JWT を盗聴されると簡単に中身を確認可能なのでパスワード等の情報は入れないこと。")])]),t._v(" "),_("p",[_("img",{attrs:{src:"/assets/img/jwt-introduction-4-79083ea9-7059-426a-81c4-2976ea7f9742.png",alt:""}})])])])]),t._v(" "),_("li",[t._v("VERIFY SIGNATURE\n"),_("ul",[_("li",[t._v("署名情報を格納する。")])])])]),t._v(" "),_("h2",{attrs:{id:"メリット"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#メリット"}},[t._v("#")]),t._v(" メリット")]),t._v(" "),_("h3",{attrs:{id:"ステートレス"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#ステートレス"}},[t._v("#")]),t._v(" ステートレス")]),t._v(" "),_("p",[t._v("サーバ側は送られてきた JWT を検証するだけでよいため、セッション管理する必要がない。")]),t._v(" "),_("p",[t._v("ロードバランサによる分散環境や、他システムとのシングルサインオンの際に、セッション情報を同期する必要がなく便利。")]),t._v(" "),_("h3",{attrs:{id:"db-アクセスの削減"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#db-アクセスの削減"}},[t._v("#")]),t._v(" DB アクセスの削減")]),t._v(" "),_("p",[t._v("PAYLOAD にユーザの権限情報などを乗せておけば、DB に問い合わせるコストを削減できる。")]),t._v(" "),_("h2",{attrs:{id:"デメリット"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#デメリット"}},[t._v("#")]),t._v(" デメリット")]),t._v(" "),_("h3",{attrs:{id:"セキュリティ"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#セキュリティ"}},[t._v("#")]),t._v(" セキュリティ")]),t._v(" "),_("p",[t._v("一度発行してしまった JWT はサーバ側で制御ができない。盗聴された JWT を無効化することができない。")]),t._v(" "),_("h3",{attrs:{id:"通信コスト"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#通信コスト"}},[t._v("#")]),t._v(" 通信コスト")]),t._v(" "),_("p",[t._v("リクエストのたびに JWT を付加するため、PAYLOAD に情報を乗せすぎると通信コストがかさむ。")]),t._v(" "),_("h2",{attrs:{id:"その他ポイント"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#その他ポイント"}},[t._v("#")]),t._v(" その他ポイント")]),t._v(" "),_("h3",{attrs:{id:"クライアント側での-jwt-の扱い方"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#クライアント側での-jwt-の扱い方"}},[t._v("#")]),t._v(" クライアント側での JWT の扱い方")]),t._v(" "),_("p",[t._v("発行された JWT は、基本的には LocalStorage 等に保持し、リクエストのたびにインターセプタで Authorization ヘッダに付加する。")]),t._v(" "),_("p",[_("code",[t._v("Authorization: Bearer [JWT文字列]")])])])}),[],!1,null,null,null);a.default=r.exports}}]);